import{_ as q}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css               *//* empty css               *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                          *//* empty css                 *//* empty css                  */import{p as C}from"./papers-CVFD9aL8.js";import{r as y,a as z,c as A,b as S,e as n,f as t,w as l,a2 as $,n as o,P as J,a6 as K,G as b,a4 as Q,ag as W,q as X,E as Z,j as h,an as ee,ao as te,ap as le,m as oe,ad as ae,a7 as se,s as ne,t as Y,v as i,a0 as D}from"./index-BxcNgWEf.js";const re={class:"import-export-container"},pe={class:"card"},de={class:"import-section"},ie={class:"import-actions"},ue={class:"card"},me={class:"export-section"},ce={class:"export-actions"},_e={class:"card history-card"},fe={__name:"ImportExport",setup(xe){const v=y(!1),g=y(!1),m=y([]),r=z({scope:"my",types:["journal","conference","degree"],yearRange:[],fields:["basic","author","journal"]}),j=y([{type:"export",description:"导出我的论文数据",count:15,status:"success",created_at:"2024-01-15 14:30:00"}]),M=s=>{const e=s.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||s.type==="application/vnd.ms-excel",u=s.size/1024/1024<10;return e?u?!0:(i.error("文件大小不能超过10MB"),!1):(i.error("只能上传Excel文件"),!1)},B=()=>{const s=document.createElement("a");s.href="/templates/paper_import_template.xlsx",s.download="论文导入模板.xlsx",s.click()},L=async()=>{if(m.value.length===0){i.warning("请先选择要导入的文件");return}v.value=!0;try{const s=m.value[0].raw;await C.importPapers(s),i.success("数据导入成功"),m.value=[]}catch{i.error("数据导入失败")}finally{v.value=!1}},T=async()=>{var s,e;g.value=!0;try{const u={scope:r.scope,types:r.types,startYear:(s=r.yearRange)==null?void 0:s[0],endYear:(e=r.yearRange)==null?void 0:e[1],fields:r.fields},p=await C.exportPapers(u),f=window.URL.createObjectURL(new Blob([p.data])),c=document.createElement("a");c.href=f,c.download=`论文数据_${D().format("YYYY-MM-DD")}.xlsx`,c.click(),window.URL.revokeObjectURL(f),i.success("数据导出成功")}catch{i.error("数据导出失败")}finally{g.value=!1}},I=s=>D(s).format("YYYY-MM-DD HH:mm");return(s,e)=>{const u=b("Upload"),p=J,f=b("upload-filled"),c=W,E=b("Download"),w=X,V=Q,k=te,F=ee,x=h,d=oe,U=le,P=ae,G=Z,H=$,N=b("Clock"),R=ne,_=se,O=K;return S(),A("div",re,[e[23]||(e[23]=n("div",{class:"page-header"},[n("h1",{class:"page-title"},"数据导入导出"),n("p",{class:"page-description"},"批量处理论文数据，支持Excel格式导入导出")],-1)),t(H,{gutter:24},{default:l(()=>[t(V,{span:12},{default:l(()=>[n("div",pe,[n("h3",null,[t(p,null,{default:l(()=>[t(u)]),_:1}),e[5]||(e[5]=o(" 数据导入",-1))]),n("div",de,[t(c,{class:"upload-demo",drag:!0,"auto-upload":!1,accept:".xlsx,.xls","before-upload":M,"file-list":m.value,"onUpdate:fileList":e[0]||(e[0]=a=>m.value=a)},{tip:l(()=>[...e[6]||(e[6]=[n("div",{class:"el-upload__tip"}," 只能上传xlsx/xls文件，且不超过10MB ",-1)])]),default:l(()=>[t(p,{class:"el-icon--upload"},{default:l(()=>[t(f)]),_:1}),e[7]||(e[7]=n("div",{class:"el-upload__text"},[o(" 将Excel文件拖到此处，或"),n("em",null,"点击上传")],-1))]),_:1},8,["file-list"]),n("div",ie,[t(w,{onClick:B},{default:l(()=>[t(p,null,{default:l(()=>[t(E)]),_:1}),e[8]||(e[8]=o(" 下载模板 ",-1))]),_:1}),t(w,{type:"primary",onClick:L,loading:v.value},{default:l(()=>[...e[9]||(e[9]=[o(" 开始导入 ",-1)])]),_:1},8,["loading"])])])])]),_:1}),t(V,{span:12},{default:l(()=>[n("div",ue,[n("h3",null,[t(p,null,{default:l(()=>[t(E)]),_:1}),e[10]||(e[10]=o(" 数据导出",-1))]),n("div",me,[t(G,{model:r,"label-width":"100px"},{default:l(()=>[t(x,{label:"导出范围"},{default:l(()=>[t(F,{modelValue:r.scope,"onUpdate:modelValue":e[1]||(e[1]=a=>r.scope=a)},{default:l(()=>[t(k,{label:"all"},{default:l(()=>[...e[11]||(e[11]=[o("全部数据",-1)])]),_:1}),t(k,{label:"my"},{default:l(()=>[...e[12]||(e[12]=[o("我的论文",-1)])]),_:1}),t(k,{label:"approved"},{default:l(()=>[...e[13]||(e[13]=[o("已审核通过",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"论文类型"},{default:l(()=>[t(U,{modelValue:r.types,"onUpdate:modelValue":e[2]||(e[2]=a=>r.types=a)},{default:l(()=>[t(d,{label:"journal"},{default:l(()=>[...e[14]||(e[14]=[o("期刊论文",-1)])]),_:1}),t(d,{label:"conference"},{default:l(()=>[...e[15]||(e[15]=[o("学会论文",-1)])]),_:1}),t(d,{label:"degree"},{default:l(()=>[...e[16]||(e[16]=[o("学位论文",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"发表年度"},{default:l(()=>[t(P,{modelValue:r.yearRange,"onUpdate:modelValue":e[3]||(e[3]=a=>r.yearRange=a),type:"yearrange","range-separator":"至","start-placeholder":"开始年度","end-placeholder":"结束年度",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),_:1}),t(x,{label:"包含字段"},{default:l(()=>[t(U,{modelValue:r.fields,"onUpdate:modelValue":e[4]||(e[4]=a=>r.fields=a)},{default:l(()=>[t(d,{label:"basic"},{default:l(()=>[...e[17]||(e[17]=[o("基本信息",-1)])]),_:1}),t(d,{label:"author"},{default:l(()=>[...e[18]||(e[18]=[o("作者信息",-1)])]),_:1}),t(d,{label:"journal"},{default:l(()=>[...e[19]||(e[19]=[o("期刊信息",-1)])]),_:1}),t(d,{label:"audit"},{default:l(()=>[...e[20]||(e[20]=[o("审核信息",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),n("div",ce,[t(w,{type:"primary",onClick:T,loading:g.value},{default:l(()=>[t(p,null,{default:l(()=>[t(E)]),_:1}),e[21]||(e[21]=o(" 导出数据 ",-1))]),_:1},8,["loading"])])])])]),_:1})]),_:1}),n("div",_e,[n("h3",null,[t(p,null,{default:l(()=>[t(N)]),_:1}),e[22]||(e[22]=o(" 操作历史",-1))]),t(O,{data:j.value,stripe:""},{default:l(()=>[t(_,{prop:"type",label:"操作类型",width:"100"},{default:l(({row:a})=>[t(R,{type:a.type==="import"?"success":"info"},{default:l(()=>[o(Y(a.type==="import"?"导入":"导出"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"description",label:"操作描述"}),t(_,{prop:"count",label:"数据量",width:"100"}),t(_,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(R,{type:a.status==="success"?"success":"danger"},{default:l(()=>[o(Y(a.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"created_at",label:"操作时间",width:"150"},{default:l(({row:a})=>[o(Y(I(a.created_at)),1)]),_:1})]),_:1},8,["data"])])])}}},Be=q(fe,[["__scopeId","data-v-65de163e"]]);export{Be as default};
