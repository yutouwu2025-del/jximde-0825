import{_ as z}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                         *//* empty css                     *//* empty css               */import{n as u}from"./notifications-iykU-k1X.js";import{r as _,a as J,o as K,c as x,b as f,e as l,f as o,w as e,q as Q,F as W,h as X,I as tt,G as D,n as i,P as et,M as N,t as c,s as ot,V as at,Y as st,S as C,Z as lt,aq as nt,E as it,j as rt,k as dt,an as ut,ao as ct,a0 as pt,v as r,a1 as mt}from"./index-BxcNgWEf.js";const _t={class:"notifications-container"},ft={class:"page-header"},vt={class:"header-right"},gt={class:"notifications-list"},wt={class:"card-header"},bt={class:"notification-title"},yt={class:"notification-actions"},ht={class:"notification-content"},Nt={class:"notification-footer"},Et={class:"notification-meta"},Vt={class:"notification-stats"},kt={class:"dialog-footer"},xt={__name:"Notifications",setup(Dt){const d=_(!1),w=_(!1),p=_(null),b=_([]),y=_(null),n=J({title:"",content:"",status:"published"}),F={title:[{required:!0,message:"请输入通知标题",trigger:"blur"}],content:[{required:!0,message:"请输入通知内容",trigger:"blur"}]},M=()=>{p.value=null,Object.assign(n,{title:"",content:"",status:"published"}),d.value=!0},B=async(a,t)=>{switch(a){case"edit":I(t);break;case"publish":await Y(t);break;case"unpublish":await j(t);break;case"delete":await q(t);break}},I=a=>{p.value=a,Object.assign(n,{title:a.title,content:a.content,status:a.status}),d.value=!0},R=async()=>{if(y.value)try{if(!await y.value.validate())return;w.value=!0,p.value?(await u.updateNotification(p.value.id,n),r.success("通知更新成功")):(await u.createNotification(n),r.success("通知发布成功")),d.value=!1,m()}catch{r.error("操作失败")}finally{w.value=!1}},Y=async a=>{try{await u.toggleNotificationStatus(a.id,"published"),r.success("通知发布成功"),m()}catch{r.error("发布失败")}},j=async a=>{try{await u.toggleNotificationStatus(a.id,"draft"),r.success("通知已撤回"),m()}catch{r.error("撤回失败")}},q=async a=>{try{await mt.confirm("确定要删除这条通知吗？","确认删除",{type:"warning"}),await u.deleteNotification(a.id),r.success("删除成功"),m()}catch(t){t!=="cancel"&&r.error("删除失败")}},A=a=>pt(a).format("YYYY-MM-DD HH:mm"),m=async()=>{try{const a=await u.getNotifications();b.value=a.data.notifications||[]}catch{b.value=[{id:1,title:"系统维护通知",content:"系统将于本周日凌晨2:00-4:00进行维护升级，届时将无法访问，请提前做好相关准备工作。",status:"published",author:"系统管理员",created_at:"2024-01-15 10:00:00",read_count:125}]}};return K(()=>{m()}),(a,t)=>{const S=D("Plus"),E=et,v=Q,U=ot,P=D("ArrowDown"),g=lt,T=st,G=at,H=nt,V=dt,h=rt,k=ct,L=ut,O=it,Z=tt;return f(),x("div",_t,[l("div",ft,[t[6]||(t[6]=l("div",{class:"header-left"},[l("h1",{class:"page-title"},"通知公告"),l("p",{class:"page-description"},"发布和管理系统通知公告")],-1)),l("div",vt,[o(v,{type:"primary",onClick:M},{default:e(()=>[o(E,null,{default:e(()=>[o(S)]),_:1}),t[5]||(t[5]=i(" 发布通知 ",-1))]),_:1})])]),l("div",gt,[(f(!0),x(W,null,X(b.value,s=>(f(),N(H,{key:s.id,class:"notification-card",shadow:"hover"},{header:e(()=>[l("div",wt,[l("div",bt,c(s.title),1),l("div",yt,[o(U,{type:s.status==="published"?"success":"info"},{default:e(()=>[i(c(s.status==="published"?"已发布":"草稿"),1)]),_:2},1032,["type"]),o(G,{onCommand:$=>B($,s)},{dropdown:e(()=>[o(T,null,{default:e(()=>[o(g,{command:"edit"},{default:e(()=>[...t[8]||(t[8]=[i("编辑",-1)])]),_:1}),s.status==="draft"?(f(),N(g,{key:0,command:"publish"},{default:e(()=>[...t[9]||(t[9]=[i(" 发布 ",-1)])]),_:1})):C("",!0),s.status==="published"?(f(),N(g,{key:1,command:"unpublish"},{default:e(()=>[...t[10]||(t[10]=[i(" 撤回 ",-1)])]),_:1})):C("",!0),o(g,{command:"delete",divided:""},{default:e(()=>[...t[11]||(t[11]=[i("删除",-1)])]),_:1})]),_:2},1024)]),default:e(()=>[o(v,{text:""},{default:e(()=>[t[7]||(t[7]=i(" 操作",-1)),o(E,null,{default:e(()=>[o(P)]),_:1})]),_:1})]),_:2},1032,["onCommand"])])])]),default:e(()=>[l("div",ht,[l("p",null,c(s.content),1)]),l("div",Nt,[l("div",Et,[l("span",null,"发布者："+c(s.author),1),l("span",null,"创建时间："+c(A(s.created_at)),1)]),l("div",Vt,[l("span",null,"阅读量："+c(s.read_count||0),1)])])]),_:2},1024))),128))]),o(Z,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=s=>d.value=s),title:p.value?"编辑通知":"发布通知",width:"600px","close-on-click-modal":!1},{footer:e(()=>[l("div",kt,[o(v,{onClick:t[3]||(t[3]=s=>d.value=!1)},{default:e(()=>[...t[14]||(t[14]=[i("取消",-1)])]),_:1}),o(v,{type:"primary",onClick:R,loading:w.value},{default:e(()=>[...t[15]||(t[15]=[i(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:e(()=>[o(O,{ref_key:"notificationFormRef",ref:y,model:n,rules:F,"label-width":"100px"},{default:e(()=>[o(h,{label:"通知标题",prop:"title"},{default:e(()=>[o(V,{modelValue:n.title,"onUpdate:modelValue":t[0]||(t[0]=s=>n.title=s),placeholder:"请输入通知标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(h,{label:"通知内容",prop:"content"},{default:e(()=>[o(V,{modelValue:n.content,"onUpdate:modelValue":t[1]||(t[1]=s=>n.content=s),type:"textarea",rows:6,placeholder:"请输入通知内容",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(h,{label:"发布状态",prop:"status"},{default:e(()=>[o(L,{modelValue:n.status,"onUpdate:modelValue":t[2]||(t[2]=s=>n.status=s)},{default:e(()=>[o(k,{label:"draft"},{default:e(()=>[...t[12]||(t[12]=[i("保存为草稿",-1)])]),_:1}),o(k,{label:"published"},{default:e(()=>[...t[13]||(t[13]=[i("立即发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ut=z(xt,[["__scopeId","data-v-84888e52"]]);export{Ut as default};
