import{_ as Ce}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                          *//* empty css                 *//* empty css                         *//* empty css                     */import"./el-tooltip-l0sNRNKZ.js";import{x as h,u as Ve,r as c,y as I,z as Be,A as Ue,o as De,B as Me,c as x,b as r,f as e,e as l,w as o,C as Ie,D as ze,G as m,H as Ae,I as Fe,i as Le,J as z,K as A,L as Re,F as H,h as $,M as p,N as Se,O as W,P as Ne,Q as j,n as i,t as _,q as Te,R as qe,S as F,T as He,U as $e,V as We,W as je,X as G,Y as Ge,Z as Je,_ as Ke,$ as Oe,E as Qe,j as Xe,k as Ye,v as w,a0 as Ze,a1 as eo}from"./index-BxcNgWEf.js";import{n as L}from"./notifications-iykU-k1X.js";const oo={login(y){return h.post("/auth/login",y)},logout(){return h.post("/auth/logout")},getCurrentUser(){return h.get("/auth/me")},changePassword(y){return h.post("/auth/change-password",y)},refreshToken(){return h.post("/auth/refresh")}},ao={class:"layout-container"},to={class:"sidebar-header"},so={class:"sidebar-logo"},no={class:"sidebar-title"},lo={class:"layout-main"},ro={class:"header-left"},uo={class:"header-right"},io={class:"user-info"},co={class:"layout-content"},mo={class:"notification-list"},po={class:"notification-header"},_o={class:"notification-time"},wo={class:"notification-content"},fo={__name:"Layout",setup(y){const R=Le(),P=Be(),E=Ve(),u=c(!1),C=c(!1),f=c(!1),V=c(!1),v=c(0),b=c([]),k=c(null),d=c({oldPassword:"",newPassword:"",confirmPassword:""}),J={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"新密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(t,a,n)=>{a!==d.value.newPassword?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}]},K=I(()=>E.getMenuItems()),O=I(()=>P.path),S=I(()=>P.meta.title),Q=()=>{u.value=!u.value},X=t=>{P.path!==t&&R.push(t)},Y=async t=>{switch(t){case"profile":w.info("个人设置功能开发中...");break;case"changePassword":f.value=!0;break;case"logout":await Z();break}},Z=async()=>{try{await eo.confirm("确定要退出登录吗？","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E.logout(),w.success("已成功退出登录"),R.push("/login")}catch(t){t!=="cancel"&&w.error("退出登录失败")}},ee=async()=>{C.value=!0,await oe()},oe=async()=>{try{const t=await L.getUserNotifications({limit:50});b.value=t.data.notifications||[]}catch(t){console.error("加载通知失败:",t)}},ae=async t=>{try{await L.markAsRead(t);const a=b.value.find(n=>n.id===t);a&&(a.read=!0,v.value=Math.max(0,v.value-1)),w.success("已标记为已读")}catch{w.error("操作失败")}},te=async()=>{var t,a;if(k.value)try{if(!await k.value.validate())return;V.value=!0,await oo.changePassword({oldPassword:d.value.oldPassword,newPassword:d.value.newPassword}),w.success("密码修改成功"),f.value=!1,d.value={oldPassword:"",newPassword:"",confirmPassword:""},k.value.resetFields()}catch(n){w.error(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"密码修改失败")}finally{V.value=!1}},se=t=>Ze(t).format("MM-DD HH:mm"),N=async()=>{try{const t=await L.getUnreadCount();v.value=t.data.count||0}catch(t){console.error("加载未读通知数量失败:",t)}};return Ue(()=>P.path,()=>{window.innerWidth<=768&&(u.value=!0)}),De(async()=>{await N(),setInterval(N,3e4);const t=()=>{window.innerWidth<=768&&(u.value=!0)};window.addEventListener("resize",t),t(),Me(()=>{window.removeEventListener("resize",t)})}),(t,a)=>{const n=Ne,ne=Se,le=Re,re=Ie,de=m("Expand"),ue=m("Fold"),g=Te,T=He,ie=qe,ce=m("Bell"),me=$e,pe=je,_e=m("ArrowDown"),we=m("User"),B=Je,fe=m("Lock"),ve=m("SwitchButton"),ge=Ge,he=We,ye=ze,Pe=m("router-view"),Ee=Oe,be=Ae,U=Ye,D=Xe,ke=Qe,xe=Fe;return r(),x("div",ao,[e(re,{width:u.value?"64px":"200px",class:"layout-aside"},{default:o(()=>[l("div",to,[z(l("div",so,"📊",512),[[A,!u.value]]),z(l("h3",no,"论文管理平台",512),[[A,!u.value]])]),e(le,{"default-active":O.value,collapse:u.value,"unique-opened":!0,class:"sidebar-menu","background-color":"#001529","text-color":"rgba(255, 255, 255, 0.65)","active-text-color":"#fff",onSelect:X},{default:o(()=>[(r(!0),x(H,null,$(K.value,s=>(r(),p(ne,{key:s.name,index:s.path,class:W({"is-active":t.$route.path===s.path})},{title:o(()=>[i(_(s.title),1)]),default:o(()=>[e(n,null,{default:o(()=>[(r(),p(j(s.icon)))]),_:2},1024)]),_:2},1032,["index","class"]))),128))]),_:1},8,["default-active","collapse"])]),_:1},8,["width"]),l("div",lo,[e(ye,{class:"layout-header",height:"64px"},{default:o(()=>[l("div",ro,[e(g,{text:"",size:"large",onClick:Q},{default:o(()=>[e(n,null,{default:o(()=>[u.value?(r(),p(de,{key:0})):(r(),p(ue,{key:1}))]),_:1})]),_:1}),e(ie,{separator:"/"},{default:o(()=>[e(T,{to:{path:"/dashboard"}},{default:o(()=>[...a[6]||(a[6]=[i("首页",-1)])]),_:1}),S.value?(r(),p(T,{key:0},{default:o(()=>[i(_(S.value),1)]),_:1})):F("",!0)]),_:1})]),l("div",uo,[e(me,{value:v.value,hidden:v.value===0,class:"notification-badge"},{default:o(()=>[e(g,{text:"",size:"large",onClick:ee},{default:o(()=>[e(n,null,{default:o(()=>[e(ce)]),_:1})]),_:1})]),_:1},8,["value","hidden"]),e(he,{onCommand:Y},{dropdown:o(()=>[e(ge,null,{default:o(()=>[e(B,{command:"profile"},{default:o(()=>[e(n,null,{default:o(()=>[e(we)]),_:1}),a[7]||(a[7]=i("个人设置 ",-1))]),_:1}),e(B,{command:"changePassword"},{default:o(()=>[e(n,null,{default:o(()=>[e(fe)]),_:1}),a[8]||(a[8]=i("修改密码 ",-1))]),_:1}),e(B,{divided:"",command:"logout"},{default:o(()=>[e(n,null,{default:o(()=>[e(ve)]),_:1}),a[9]||(a[9]=i("退出登录 ",-1))]),_:1})]),_:1})]),default:o(()=>{var s;return[l("div",io,[e(pe,{size:36,class:"user-avatar"},{default:o(()=>{var M,q;return[i(_(((q=(M=G(E).user)==null?void 0:M.name)==null?void 0:q.charAt(0))||"U"),1)]}),_:1}),z(l("span",{class:"user-name"},_(((s=G(E).user)==null?void 0:s.name)||"用户"),513),[[A,!u.value]]),e(n,{class:"user-dropdown-icon"},{default:o(()=>[e(_e)]),_:1})])]}),_:1})])]),_:1}),l("div",co,[e(Pe,null,{default:o(({Component:s})=>[e(Ke,{name:"fade-slide",mode:"out-in"},{default:o(()=>[(r(),p(j(s)))]),_:2},1024)]),_:1})])]),e(be,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=s=>C.value=s),title:"系统通知",direction:"rtl",size:"400px"},{default:o(()=>[l("div",mo,[b.value.length===0?(r(),p(Ee,{key:0,description:"暂无通知"})):F("",!0),(r(!0),x(H,null,$(b.value,s=>(r(),x("div",{key:s.id,class:W(["notification-item",{unread:!s.read}])},[l("div",po,[l("h4",null,_(s.title),1),l("span",_o,_(se(s.created_at)),1)]),l("p",wo,_(s.content),1),s.read?F("",!0):(r(),p(g,{key:0,text:"",size:"small",onClick:M=>ae(s.id)},{default:o(()=>[...a[10]||(a[10]=[i(" 标记为已读 ",-1)])]),_:2},1032,["onClick"]))],2))),128))])]),_:1},8,["modelValue"]),e(xe,{modelValue:f.value,"onUpdate:modelValue":a[5]||(a[5]=s=>f.value=s),title:"修改密码",width:"400px","close-on-click-modal":!1},{footer:o(()=>[e(g,{onClick:a[4]||(a[4]=s=>f.value=!1)},{default:o(()=>[...a[11]||(a[11]=[i("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:te,loading:V.value},{default:o(()=>[...a[12]||(a[12]=[i(" 确认修改 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[e(ke,{ref_key:"passwordFormRef",ref:k,model:d.value,rules:J,"label-width":"100px"},{default:o(()=>[e(D,{label:"原密码",prop:"oldPassword"},{default:o(()=>[e(U,{modelValue:d.value.oldPassword,"onUpdate:modelValue":a[1]||(a[1]=s=>d.value.oldPassword=s),type:"password","show-password":"",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),e(D,{label:"新密码",prop:"newPassword"},{default:o(()=>[e(U,{modelValue:d.value.newPassword,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value.newPassword=s),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),e(D,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[e(U,{modelValue:d.value.confirmPassword,"onUpdate:modelValue":a[3]||(a[3]=s=>d.value.confirmPassword=s),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Uo=Ce(fo,[["__scopeId","data-v-7e7f5465"]]);export{Uo as default};
