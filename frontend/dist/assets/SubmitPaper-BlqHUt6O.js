import{_ as ye}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                     *//* empty css                             *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                     *//* empty css               *//* empty css                             *//* empty css                  */import{x as w,r as _,a as Ve,c as N,b as S,e as r,f as e,w as t,a9 as he,E as we,i as Ee,G as U,aa as Se,J as F,n,P as Ue,j as xe,k as ke,ab as Ae,ac as Fe,ad as Ce,K as C,ae as De,t as d,s as Ne,a2 as je,a4 as Ie,af as Ye,S as D,ag as Je,ah as Pe,q as Me,ai as ze,aj as Te,M as O,v as g,a1 as Be}from"./index-BxcNgWEf.js";import{p as L}from"./papers-CVFD9aL8.js";const Oe={searchJournals(p){const{year:b="2023",keyword:y,user:x="imdeJCRfq",password:u="imde2012"}=p;return w.get("https://webapi.fenqubiao.com/api/v2/user/search",{params:{year:b,keyword:y,user:x,password:u}})},getJournalInfo(p){const{year:b="2023",keyword:y,user:x="imdeJCRfq",password:u="imde2012"}=p;return w.get("https://webapi.fenqubiao.com/api/v2/user/get",{params:{year:b,keyword:y,user:x,password:u}})},getLocalJournals(p={}){return w.get("/journals",{params:p})},addJournalToCache(p){return w.post("/journals",p)},updateLocalJournal(p,b){return w.put(`/journals/${p}`,b)},deleteLocalJournal(p){return w.delete(`/journals/${p}`)},syncJournalData(p="2023"){return w.post("/journals/sync",{year:p})}},Le={class:"submit-paper-container"},Re={class:"form-container"},qe={class:"step-content"},Qe={class:"step-title"},Ke={class:"step-content"},Xe={class:"step-title"},$e={class:"journal-suggestion"},Ge={class:"journal-name"},He={class:"journal-info"},We={class:"step-content"},Ze={class:"step-title"},el={class:"step-content"},ll={class:"step-title"},tl={key:0,class:"upload-progress"},al={key:1,class:"uploaded-file"},ol={class:"file-info"},sl={class:"step-content"},rl={class:"step-title"},nl={class:"paper-preview"},ul={class:"form-actions"},il={key:2,class:"submit-actions"},pl={__name:"SubmitPaper",setup(p){const b=Ee(),y=_(null),x=_(null),u=_(0),z=_(""),j=_(!1),I=_([]),V=_(0),Y=_("success"),J=_(!1),P=_(!1),a=Ve({title:"",type:"",publishYear:"",language:"",doi:"",journalName:"",issn:"",partition:"",institutionOrder:1,firstAuthor:"",correspondingAuthor:"",allAuthors:"",authorInstitutions:"",paperFile:null}),R={title:[{required:!0,message:"请输入论文标题",trigger:"blur"},{min:5,max:200,message:"标题长度在 5 到 200 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择论文类型",trigger:"change"}],publishYear:[{required:!0,message:"请选择发表年度",trigger:"change"}],language:[{required:!0,message:"请选择语种",trigger:"change"}],journalName:[{required:!0,message:"请选择期刊",trigger:"blur"}],firstAuthor:[{required:!0,message:"请输入第一作者",trigger:"blur"}],correspondingAuthor:[{required:!0,message:"请输入第一通讯作者",trigger:"blur"}]},q=async(o,l)=>{if(!o||o.length<2){l([]);return}j.value=!0;try{const k=(await Oe.searchJournals({keyword:o,year:"2023"})).data.map(m=>({value:m.name,name:m.name,issn:m.issn,partition:m.partition,...m}));l(k)}catch(c){console.error("搜索期刊失败:",c);const k=[{value:"Nature",name:"Nature",issn:"0028-0836",partition:"Q1"},{value:"Science",name:"Science",issn:"0036-8075",partition:"Q1"},{value:"Cell",name:"Cell",issn:"0092-8674",partition:"Q1"}].filter(m=>m.name.toLowerCase().includes(o.toLowerCase())||m.issn.includes(o));l(k)}finally{j.value=!1}},Q=o=>{a.journalName=o.name,a.issn=o.issn,a.partition=o.partition},K=o=>o==="Q1"?"success":o==="Q2"?"info":o==="Q3"?"warning":"danger",X=o=>({journal:"期刊论文",conference:"学会论文",degree:"学位论文"})[o]||"未知",$=o=>({chinese:"中文",english:"英文",other:"其他"})[o]||"未知",G=o=>{const l=o.type==="application/pdf"||o.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document",c=o.size/1024/1024<50;return l?c?!0:(g.error("文件大小不能超过50MB"),!1):(g.error("文件格式不正确，请上传PDF或DOCX文件"),!1)},H=o=>{V.value=Math.round(o.loaded*100/o.total)},W=(o,l)=>{V.value=100,Y.value="success",a.paperFile={name:l.name,url:o.url,id:o.id},g.success("文件上传成功")},Z=o=>{V.value=0,Y.value="exception",g.error("文件上传失败，请重试")},ee=()=>{a.paperFile=null,I.value=[],V.value=0},le=async()=>{if(!y.value)return;const o=ae(u.value);try{if(await y.value.validateField(o),u.value===3&&!a.paperFile){g.error("请上传论文文件");return}u.value++}catch{g.error("请完善当前步骤的信息")}},te=()=>{u.value>0&&u.value--},ae=o=>({0:["title","type","publishYear","language"],1:["journalName"],2:["firstAuthor","correspondingAuthor"],3:[],4:[]})[o]||[],oe=async()=>{J.value=!0;try{const o={...a,status:"draft"};await L.submitPaper(o),g.success("草稿保存成功"),b.push("/my-papers")}catch{g.error("保存草稿失败")}finally{J.value=!1}},se=async()=>{try{await Be.confirm("确定要提交论文进行审核吗？提交后将无法修改。","确认提交",{confirmButtonText:"确定提交",cancelButtonText:"取消",type:"warning"}),P.value=!0;const o={...a,status:"pending"};await L.submitPaper(o),g.success("论文提交成功，请等待审核"),b.push("/my-papers")}catch(o){o!=="cancel"&&g.error("提交失败，请稍后重试")}finally{P.value=!1}};return(o,l)=>{const c=Se,k=he,m=U("Document"),h=Ue,v=ke,i=xe,E=Fe,T=Ae,re=Ce,ne=U("Search"),M=Ne,ue=De,B=Ie,ie=je,pe=Ye,de=U("User"),me=U("Upload"),ce=U("upload-filled"),fe=Je,_e=Pe,A=Me,ge=U("Check"),f=Te,ve=ze,be=we;return S(),N("div",Le,[l[30]||(l[30]=r("div",{class:"page-header"},[r("h1",{class:"page-title"},"论文提交"),r("p",{class:"page-description"},"请填写完整的论文信息，提交后将进入审核流程")],-1)),e(k,{active:u.value,"align-center":"",class:"submit-steps"},{default:t(()=>[e(c,{title:"基本信息",description:"填写论文基础信息"}),e(c,{title:"期刊信息",description:"选择发表期刊"}),e(c,{title:"作者信息",description:"填写作者详情"}),e(c,{title:"文件上传",description:"上传论文文件"}),e(c,{title:"提交审核",description:"确认并提交"})]),_:1},8,["active"]),r("div",Re,[e(be,{ref_key:"paperFormRef",ref:y,model:a,rules:R,"label-width":"120px",size:"large"},{default:t(()=>[F(r("div",qe,[r("div",Qe,[e(h,null,{default:t(()=>[e(m)]),_:1}),l[15]||(l[15]=n(" 基本信息 ",-1))]),e(i,{label:"论文标题",prop:"title"},{default:t(()=>[e(v,{modelValue:a.title,"onUpdate:modelValue":l[0]||(l[0]=s=>a.title=s),placeholder:"请输入论文标题（中英文均可）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(i,{label:"论文类型",prop:"type"},{default:t(()=>[e(T,{modelValue:a.type,"onUpdate:modelValue":l[1]||(l[1]=s=>a.type=s),placeholder:"请选择论文类型"},{default:t(()=>[e(E,{label:"期刊论文",value:"journal"}),e(E,{label:"学会论文",value:"conference"}),e(E,{label:"学位论文",value:"degree"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"发表年度",prop:"publishYear"},{default:t(()=>[e(re,{modelValue:a.publishYear,"onUpdate:modelValue":l[2]||(l[2]=s=>a.publishYear=s),type:"year",placeholder:"请选择发表年度",format:"YYYY","value-format":"YYYY"},null,8,["modelValue"])]),_:1}),e(i,{label:"语种",prop:"language"},{default:t(()=>[e(T,{modelValue:a.language,"onUpdate:modelValue":l[3]||(l[3]=s=>a.language=s),placeholder:"请选择语种"},{default:t(()=>[e(E,{label:"中文",value:"chinese"}),e(E,{label:"英文",value:"english"}),e(E,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"DOI",prop:"doi"},{default:t(()=>[e(v,{modelValue:a.doi,"onUpdate:modelValue":l[4]||(l[4]=s=>a.doi=s),placeholder:"请输入DOI（如：10.1038/nature12373）"},null,8,["modelValue"])]),_:1})],512),[[C,u.value===0]]),F(r("div",Ke,[r("div",Xe,[e(h,null,{default:t(()=>[e(ne)]),_:1}),l[16]||(l[16]=n(" 期刊信息 ",-1))]),e(i,{label:"期刊搜索",prop:"journal"},{default:t(()=>[e(ue,{modelValue:z.value,"onUpdate:modelValue":l[5]||(l[5]=s=>z.value=s),"fetch-suggestions":q,placeholder:"请输入期刊名称或ISSN号进行搜索",clearable:"",style:{width:"100%"},onSelect:Q,loading:j.value},{default:t(({item:s})=>[r("div",$e,[r("div",Ge,d(s.name),1),r("div",He,[e(M,{size:"small",type:"info"},{default:t(()=>[n(d(s.issn),1)]),_:2},1024),e(M,{size:"small",type:K(s.partition)},{default:t(()=>[n(d(s.partition)+"分区 ",1)]),_:2},1032,["type"])])])]),_:1},8,["modelValue","loading"])]),_:1}),e(i,{label:"期刊名称",prop:"journalName"},{default:t(()=>[e(v,{modelValue:a.journalName,"onUpdate:modelValue":l[6]||(l[6]=s=>a.journalName=s),placeholder:"期刊全称",readonly:""},null,8,["modelValue"])]),_:1}),e(ie,{gutter:16},{default:t(()=>[e(B,{span:12},{default:t(()=>[e(i,{label:"ISSN编号",prop:"issn"},{default:t(()=>[e(v,{modelValue:a.issn,"onUpdate:modelValue":l[7]||(l[7]=s=>a.issn=s),placeholder:"ISSN编号",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e(i,{label:"期刊分区",prop:"partition"},{default:t(()=>[e(v,{modelValue:a.partition,"onUpdate:modelValue":l[8]||(l[8]=s=>a.partition=s),placeholder:"期刊分区",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(i,{label:"发表单位排序",prop:"institutionOrder"},{default:t(()=>[e(pe,{modelValue:a.institutionOrder,"onUpdate:modelValue":l[9]||(l[9]=s=>a.institutionOrder=s),min:1,max:10,placeholder:"本单位在作者单位中的排序"},null,8,["modelValue"])]),_:1})],512),[[C,u.value===1]]),F(r("div",We,[r("div",Ze,[e(h,null,{default:t(()=>[e(de)]),_:1}),l[17]||(l[17]=n(" 作者信息 ",-1))]),e(i,{label:"第一作者",prop:"firstAuthor"},{default:t(()=>[e(v,{modelValue:a.firstAuthor,"onUpdate:modelValue":l[10]||(l[10]=s=>a.firstAuthor=s),placeholder:"第一作者姓名"},null,8,["modelValue"])]),_:1}),e(i,{label:"第一通讯作者",prop:"correspondingAuthor"},{default:t(()=>[e(v,{modelValue:a.correspondingAuthor,"onUpdate:modelValue":l[11]||(l[11]=s=>a.correspondingAuthor=s),placeholder:"第一通讯作者姓名"},null,8,["modelValue"])]),_:1}),e(i,{label:"所有作者",prop:"allAuthors"},{default:t(()=>[e(v,{modelValue:a.allAuthors,"onUpdate:modelValue":l[12]||(l[12]=s=>a.allAuthors=s),type:"textarea",rows:3,placeholder:"请按顺序输入所有作者姓名，用分号分隔"},null,8,["modelValue"])]),_:1}),e(i,{label:"作者单位",prop:"authorInstitutions"},{default:t(()=>[e(v,{modelValue:a.authorInstitutions,"onUpdate:modelValue":l[13]||(l[13]=s=>a.authorInstitutions=s),type:"textarea",rows:3,placeholder:"请输入所有作者单位，与作者顺序对应"},null,8,["modelValue"])]),_:1})],512),[[C,u.value===2]]),F(r("div",el,[r("div",ll,[e(h,null,{default:t(()=>[e(me)]),_:1}),l[18]||(l[18]=n(" 文件上传 ",-1))]),e(i,{label:"论文原文",prop:"paperFile"},{default:t(()=>[e(fe,{ref_key:"uploadRef",ref:x,class:"paper-upload",drag:!0,multiple:!1,accept:".pdf,.docx","before-upload":G,"on-progress":H,"on-success":W,"on-error":Z,"auto-upload":!1,"file-list":I.value,"onUpdate:fileList":l[14]||(l[14]=s=>I.value=s)},{tip:t(()=>[...l[19]||(l[19]=[r("div",{class:"el-upload__tip"}," 支持PDF、DOCX格式，文件大小不超过50MB ",-1)])]),default:t(()=>[e(h,{class:"el-icon--upload"},{default:t(()=>[e(ce)]),_:1}),l[20]||(l[20]=r("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),r("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),V.value>0&&V.value<100?(S(),N("div",tl,[e(_e,{percentage:V.value,status:Y.value},null,8,["percentage","status"]),l[21]||(l[21]=r("p",null,"正在上传文件，请稍候...",-1))])):D("",!0),a.paperFile?(S(),N("div",al,[r("div",ol,[e(h,null,{default:t(()=>[e(m)]),_:1}),r("span",null,d(a.paperFile.name),1),e(M,{type:"success",size:"small"},{default:t(()=>[...l[22]||(l[22]=[n("已上传",-1)])]),_:1}),e(A,{text:"",type:"danger",size:"small",onClick:ee},{default:t(()=>[...l[23]||(l[23]=[n(" 删除 ",-1)])]),_:1})])])):D("",!0)],512),[[C,u.value===3]]),F(r("div",sl,[r("div",rl,[e(h,null,{default:t(()=>[e(ge)]),_:1}),l[24]||(l[24]=n(" 提交审核 ",-1))]),r("div",nl,[l[25]||(l[25]=r("h3",null,"论文信息预览",-1)),e(ve,{column:2,border:""},{default:t(()=>[e(f,{label:"论文标题"},{default:t(()=>[n(d(a.title),1)]),_:1}),e(f,{label:"论文类型"},{default:t(()=>[n(d(X(a.type)),1)]),_:1}),e(f,{label:"期刊名称"},{default:t(()=>[n(d(a.journalName),1)]),_:1}),e(f,{label:"期刊分区"},{default:t(()=>[n(d(a.partition),1)]),_:1}),e(f,{label:"第一作者"},{default:t(()=>[n(d(a.firstAuthor),1)]),_:1}),e(f,{label:"通讯作者"},{default:t(()=>[n(d(a.correspondingAuthor),1)]),_:1}),e(f,{label:"发表年度"},{default:t(()=>[n(d(a.publishYear),1)]),_:1}),e(f,{label:"语种"},{default:t(()=>[n(d($(a.language)),1)]),_:1}),e(f,{label:"DOI"},{default:t(()=>[n(d(a.doi||"未填写"),1)]),_:1}),e(f,{label:"论文文件"},{default:t(()=>[n(d(a.paperFile?a.paperFile.name:"未上传"),1)]),_:1})]),_:1})])],512),[[C,u.value===4]]),r("div",ul,[u.value>0?(S(),O(A,{key:0,size:"large",onClick:te},{default:t(()=>[...l[26]||(l[26]=[n(" 上一步 ",-1)])]),_:1})):D("",!0),u.value<4?(S(),O(A,{key:1,type:"primary",size:"large",onClick:le},{default:t(()=>[...l[27]||(l[27]=[n(" 下一步 ",-1)])]),_:1})):D("",!0),u.value===4?(S(),N("div",il,[e(A,{size:"large",onClick:oe,loading:J.value},{default:t(()=>[...l[28]||(l[28]=[n(" 保存草稿 ",-1)])]),_:1},8,["loading"]),e(A,{type:"primary",size:"large",onClick:se,loading:P.value},{default:t(()=>[...l[29]||(l[29]=[n(" 提交审核 ",-1)])]),_:1},8,["loading"])])):D("",!0)])]),_:1},8,["model"])])])}}},Sl=ye(pl,[["__scopeId","data-v-14936d45"]]);export{Sl as default};
