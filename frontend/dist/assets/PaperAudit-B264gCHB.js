import{_ as je}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                          *//* empty css                    *//* empty css                 *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                             *//* empty css               */import{p as M}from"./papers-CVFD9aL8.js";import{r as v,a as A,o as xe,c as C,b as f,e as s,f as t,S as h,w as l,a2 as Pe,t as i,q as Ee,J as ze,a8 as De,M as q,ak as Se,I as Re,v as b,a1 as Me,a6 as Ae,G as X,a4 as Te,ab as Ue,ac as Ie,ad as $e,k as Fe,P as Be,n,a7 as Ye,s as Oe,O as Qe,ai as Ne,aj as qe,E as Ge,j as He,an as We,ao as Je,ap as Le,m as Ke,a0 as E}from"./index-BxcNgWEf.js";const Xe={class:"paper-audit-container"},Ze={class:"stat-card pending"},et={class:"stat-number"},tt={class:"stat-card today"},lt={class:"stat-number"},at={class:"stat-card approved"},ot={class:"stat-number"},st={class:"stat-card rejected"},nt={class:"stat-number"},it={class:"filter-section"},rt={key:0,class:"batch-operations"},dt={class:"batch-info"},ut={class:"batch-actions"},pt={class:"papers-table"},mt={class:"paper-info"},ct=["onClick"],ft={class:"paper-meta"},_t={class:"journal-name"},vt={key:0,class:"partition"},gt={class:"action-buttons"},yt={class:"pagination-wrapper"},bt={key:0,class:"audit-content"},kt={class:"paper-details"},wt={key:0,class:"file-preview"},Ct={class:"file-info"},Vt={class:"audit-form"},ht={class:"dialog-footer"},jt={class:"file-preview-container"},xt=["src"],Pt={key:1,class:"preview-placeholder"},Et={__name:"PaperAudit",setup(zt){const T=v(!1),j=v(!1),z=v(!1),U=v(!1),I=v([]),k=v([]),r=v(null),D=v(""),$=v(null),m=A({type:"",priority:"",dateRange:[],keyword:""}),u=A({current:1,pageSize:20,total:0}),V=A({pending:0,todayAudited:0,approved:0,rejected:0}),d=A({result:"",comment:"",rejectReasons:[],priority:"normal"}),Z={result:[{required:!0,message:"请选择审核结果",trigger:"change"}],comment:[{required:!0,message:"请填写审核意见",trigger:"blur"},{min:10,message:"审核意见至少10个字符",trigger:"blur"}]},G=a=>({journal:"期刊论文",conference:"学会论文",degree:"学位论文"})[a]||"未知",ee=a=>({high:"danger",normal:"info",low:"success"})[a]||"info",te=a=>({high:"高",normal:"普通",low:"低"})[a]||"普通",H=a=>a!=null&&a.includes("Q1")?"success":a!=null&&a.includes("Q2")?"info":a!=null&&a.includes("Q3")?"warning":"danger",le=a=>E(a).format("MM-DD HH:mm"),ae=a=>{const e=E().diff(E(a),"day");return e===0?"今天":`${e}天`},oe=a=>{const e=E().diff(E(a),"day");return e>=7?"waiting-long":e>=3?"waiting-medium":"waiting-short"},F=()=>{u.current=1,w()},se=()=>{u.current=1,w()},ne=a=>{k.value=a},ie=a=>{u.current=a,w()},re=a=>{u.pageSize=a,u.current=1,w()},de=a=>{b.info("论文详情功能开发中...")},ue=a=>{a.file_url?(D.value=a.file_url,z.value=!0):b.error("文件不存在")},pe=a=>{b.info("编辑论文信息功能开发中...")},me=a=>{r.value=a,Object.assign(d,{result:"",comment:"",rejectReasons:[],priority:a.priority||"normal"}),j.value=!0},ce=()=>{var a;(a=r.value)!=null&&a.file_url&&(D.value=r.value.file_url,z.value=!0)},fe=()=>{var a;(a=r.value)!=null&&a.file_url&&window.open(r.value.file_url,"_blank")},_e=async()=>{if($.value)try{if(!await $.value.validate())return;U.value=!0;const e={paperId:r.value.id,result:d.result,comment:d.comment,rejectReasons:d.rejectReasons,priority:d.priority};await M.auditPaper(r.value.id,e),b.success("审核提交成功"),j.value=!1,w(),B()}catch{b.error("审核提交失败")}finally{U.value=!1}},W=async a=>{if(k.value.length===0){b.warning("请选择要审核的论文");return}try{await Me.confirm(`确定要批量${a==="approved"?"通过":"拒绝"}选中的 ${k.value.length} 篇论文吗？`,"批量审核确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=k.value.map(p=>p.id);await M.batchAuditPapers(e,{result:a,comment:a==="approved"?"批量审核通过":"批量审核拒绝"}),b.success("批量审核成功"),k.value=[],w(),B()}catch(e){e!=="cancel"&&b.error("批量审核失败")}},w=async()=>{var a,e;T.value=!0;try{const p={page:u.current,pageSize:u.pageSize,type:m.type,priority:m.priority,keyword:m.keyword,startDate:(a=m.dateRange)==null?void 0:a[0],endDate:(e=m.dateRange)==null?void 0:e[1]},x=await M.getPendingPapers(p);I.value=x.data.papers||[],u.total=x.data.total||0}catch(p){console.error("加载待审核论文失败:",p),I.value=[{id:1,title:"基于深度学习的图像识别算法研究",type:"journal",journal:"Pattern Recognition",partition:"Q1",first_author:"张三",submitter:"张三",submit_time:"2024-01-10 10:30:00",priority:"high",file_url:"/files/paper1.pdf",file_name:"paper1.pdf"},{id:2,title:"机器学习在自然语言处理中的应用",type:"journal",journal:"Computer Science",partition:"Q2",first_author:"李四",submitter:"李四",submit_time:"2024-01-08 14:20:00",priority:"normal",file_url:"/files/paper2.pdf",file_name:"paper2.pdf"}],u.total=2}finally{T.value=!1}},B=async()=>{try{const a=await M.getPaperStats({type:"audit"});Object.assign(V,{pending:a.data.pending||0,todayAudited:a.data.todayAudited||0,approved:a.data.approved||0,rejected:a.data.rejected||0})}catch(a){console.error("加载审核统计失败:",a),Object.assign(V,{pending:15,todayAudited:8,approved:23,rejected:5})}};return xe(()=>{w(),B()}),(a,e)=>{const p=Te,x=Pe,c=Ie,Y=Ue,ve=$e,ge=X("Search"),O=Be,J=Fe,_=Ee,g=Ye,S=Oe,ye=Ae,be=Se,y=qe,ke=Ne,L=X("Document"),Q=Je,we=We,R=He,P=Ke,Ce=Le,Ve=Ge,K=Re,he=De;return f(),C("div",Xe,[e[40]||(e[40]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"论文审核"),s("p",{class:"page-description"},"审核待处理的论文，确保论文质量和信息准确性")],-1)),t(x,{gutter:16,class:"audit-stats"},{default:l(()=>[t(p,{xs:12,sm:6},{default:l(()=>[s("div",Ze,[s("div",et,i(V.pending),1),e[15]||(e[15]=s("div",{class:"stat-label"},"待审核",-1))])]),_:1}),t(p,{xs:12,sm:6},{default:l(()=>[s("div",tt,[s("div",lt,i(V.todayAudited),1),e[16]||(e[16]=s("div",{class:"stat-label"},"今日已审核",-1))])]),_:1}),t(p,{xs:12,sm:6},{default:l(()=>[s("div",at,[s("div",ot,i(V.approved),1),e[17]||(e[17]=s("div",{class:"stat-label"},"本月通过",-1))])]),_:1}),t(p,{xs:12,sm:6},{default:l(()=>[s("div",st,[s("div",nt,i(V.rejected),1),e[18]||(e[18]=s("div",{class:"stat-label"},"本月拒绝",-1))])]),_:1})]),_:1}),s("div",it,[t(x,{gutter:16},{default:l(()=>[t(p,{xs:24,sm:6},{default:l(()=>[t(Y,{modelValue:m.type,"onUpdate:modelValue":e[0]||(e[0]=o=>m.type=o),placeholder:"论文类型",clearable:"",onChange:F},{default:l(()=>[t(c,{label:"全部",value:""}),t(c,{label:"期刊论文",value:"journal"}),t(c,{label:"学会论文",value:"conference"}),t(c,{label:"学位论文",value:"degree"})]),_:1},8,["modelValue"])]),_:1}),t(p,{xs:24,sm:6},{default:l(()=>[t(Y,{modelValue:m.priority,"onUpdate:modelValue":e[1]||(e[1]=o=>m.priority=o),placeholder:"优先级",clearable:"",onChange:F},{default:l(()=>[t(c,{label:"全部",value:""}),t(c,{label:"高优先级",value:"high"}),t(c,{label:"普通",value:"normal"}),t(c,{label:"低优先级",value:"low"})]),_:1},8,["modelValue"])]),_:1}),t(p,{xs:24,sm:6},{default:l(()=>[t(ve,{modelValue:m.dateRange,"onUpdate:modelValue":e[2]||(e[2]=o=>m.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:F},null,8,["modelValue"])]),_:1}),t(p,{xs:24,sm:6},{default:l(()=>[t(J,{modelValue:m.keyword,"onUpdate:modelValue":e[3]||(e[3]=o=>m.keyword=o),placeholder:"搜索论文标题或作者",clearable:"",onInput:se},{prefix:l(()=>[t(O,null,{default:l(()=>[t(ge)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),k.value.length>0?(f(),C("div",rt,[s("div",dt," 已选择 "+i(k.value.length)+" 篇论文 ",1),s("div",ut,[t(_,{type:"success",onClick:e[4]||(e[4]=o=>W("approved"))},{default:l(()=>[...e[19]||(e[19]=[n(" 批量通过 ",-1)])]),_:1}),t(_,{type:"danger",onClick:e[5]||(e[5]=o=>W("rejected"))},{default:l(()=>[...e[20]||(e[20]=[n(" 批量拒绝 ",-1)])]),_:1})])])):h("",!0),s("div",pt,[ze((f(),q(ye,{data:I.value,onSelectionChange:ne,stripe:"",style:{width:"100%"}},{default:l(()=>[t(g,{type:"selection",width:"55"}),t(g,{label:"优先级",width:"80"},{default:l(({row:o})=>[t(S,{type:ee(o.priority),size:"small"},{default:l(()=>[n(i(te(o.priority)),1)]),_:2},1032,["type"])]),_:1}),t(g,{label:"论文信息","min-width":"300"},{default:l(({row:o})=>[s("div",mt,[s("div",{class:"paper-title",onClick:N=>de(o)},i(o.title),9,ct),s("div",ft,[t(S,{size:"small",class:"meta-tag"},{default:l(()=>[n(i(G(o.type)),1)]),_:2},1024),s("span",_t,i(o.journal),1),o.partition?(f(),C("span",vt,[t(S,{size:"small",type:H(o.partition)},{default:l(()=>[n(i(o.partition)+"分区 ",1)]),_:2},1032,["type"])])):h("",!0)])])]),_:1}),t(g,{prop:"first_author",label:"第一作者",width:"120"}),t(g,{prop:"submitter",label:"提交人",width:"100"}),t(g,{prop:"submit_time",label:"提交时间",width:"120"},{default:l(({row:o})=>[n(i(le(o.submit_time)),1)]),_:1}),t(g,{label:"等待时间",width:"100"},{default:l(({row:o})=>[s("span",{class:Qe(oe(o.submit_time))},i(ae(o.submit_time)),3)]),_:1}),t(g,{label:"操作",width:"220",fixed:"right"},{default:l(({row:o})=>[s("div",gt,[t(_,{type:"primary",size:"small",onClick:N=>me(o)},{default:l(()=>[...e[21]||(e[21]=[n(" 审核 ",-1)])]),_:2},1032,["onClick"]),o.file_url?(f(),q(_,{key:0,text:"",type:"info",size:"small",onClick:N=>ue(o)},{default:l(()=>[...e[22]||(e[22]=[n(" 查看原文 ",-1)])]),_:2},1032,["onClick"])):h("",!0),t(_,{text:"",type:"warning",size:"small",onClick:N=>pe(o)},{default:l(()=>[...e[23]||(e[23]=[n(" 编辑信息 ",-1)])]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[he,T.value]]),s("div",yt,[t(be,{"current-page":u.current,"onUpdate:currentPage":e[6]||(e[6]=o=>u.current=o),"page-size":u.pageSize,"onUpdate:pageSize":e[7]||(e[7]=o=>u.pageSize=o),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),t(K,{modelValue:j.value,"onUpdate:modelValue":e[13]||(e[13]=o=>j.value=o),title:"论文审核",width:"80%","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[s("div",ht,[t(_,{onClick:e[12]||(e[12]=o=>j.value=!1)},{default:l(()=>[...e[37]||(e[37]=[n("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:_e,loading:U.value},{default:l(()=>[...e[38]||(e[38]=[n(" 提交审核 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[r.value?(f(),C("div",bt,[s("div",kt,[e[24]||(e[24]=s("h3",null,"论文基本信息",-1)),t(ke,{column:2,border:""},{default:l(()=>[t(y,{label:"论文标题"},{default:l(()=>[n(i(r.value.title),1)]),_:1}),t(y,{label:"论文类型"},{default:l(()=>[n(i(G(r.value.type)),1)]),_:1}),t(y,{label:"期刊名称"},{default:l(()=>[n(i(r.value.journal),1)]),_:1}),t(y,{label:"期刊分区"},{default:l(()=>[t(S,{type:H(r.value.partition)},{default:l(()=>[n(i(r.value.partition)+"分区 ",1)]),_:1},8,["type"])]),_:1}),t(y,{label:"第一作者"},{default:l(()=>[n(i(r.value.first_author),1)]),_:1}),t(y,{label:"通讯作者"},{default:l(()=>[n(i(r.value.corresponding_author),1)]),_:1}),t(y,{label:"发表年度"},{default:l(()=>[n(i(r.value.publish_year),1)]),_:1}),t(y,{label:"DOI"},{default:l(()=>[n(i(r.value.doi||"未填写"),1)]),_:1})]),_:1})]),r.value.file_url?(f(),C("div",wt,[e[27]||(e[27]=s("h3",null,"论文文件",-1)),s("div",Ct,[t(O,null,{default:l(()=>[t(L)]),_:1}),s("span",null,i(r.value.file_name),1),t(_,{type:"primary",size:"small",onClick:ce},{default:l(()=>[...e[25]||(e[25]=[n(" 在线预览 ",-1)])]),_:1}),t(_,{type:"info",size:"small",onClick:fe},{default:l(()=>[...e[26]||(e[26]=[n(" 下载文件 ",-1)])]),_:1})])])):h("",!0),s("div",Vt,[e[36]||(e[36]=s("h3",null,"审核意见",-1)),t(Ve,{ref_key:"auditFormRef",ref:$,model:d,rules:Z,"label-width":"100px"},{default:l(()=>[t(R,{label:"审核结果",prop:"result"},{default:l(()=>[t(we,{modelValue:d.result,"onUpdate:modelValue":e[8]||(e[8]=o=>d.result=o)},{default:l(()=>[t(Q,{label:"approved"},{default:l(()=>[...e[28]||(e[28]=[n("通过",-1)])]),_:1}),t(Q,{label:"rejected"},{default:l(()=>[...e[29]||(e[29]=[n("拒绝",-1)])]),_:1}),t(Q,{label:"revision"},{default:l(()=>[...e[30]||(e[30]=[n("需要修改",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"审核意见",prop:"comment"},{default:l(()=>[t(J,{modelValue:d.comment,"onUpdate:modelValue":e[9]||(e[9]=o=>d.comment=o),type:"textarea",rows:4,placeholder:"请填写详细的审核意见..."},null,8,["modelValue"])]),_:1}),d.result==="rejected"?(f(),q(R,{key:0,label:"拒绝原因",prop:"rejectReason"},{default:l(()=>[t(Ce,{modelValue:d.rejectReasons,"onUpdate:modelValue":e[10]||(e[10]=o=>d.rejectReasons=o)},{default:l(()=>[t(P,{label:"信息不完整"},{default:l(()=>[...e[31]||(e[31]=[n("信息不完整",-1)])]),_:1}),t(P,{label:"期刊信息错误"},{default:l(()=>[...e[32]||(e[32]=[n("期刊信息错误",-1)])]),_:1}),t(P,{label:"文件格式不正确"},{default:l(()=>[...e[33]||(e[33]=[n("文件格式不正确",-1)])]),_:1}),t(P,{label:"作者信息有误"},{default:l(()=>[...e[34]||(e[34]=[n("作者信息有误",-1)])]),_:1}),t(P,{label:"其他"},{default:l(()=>[...e[35]||(e[35]=[n("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):h("",!0),t(R,{label:"优先级调整"},{default:l(()=>[t(Y,{modelValue:d.priority,"onUpdate:modelValue":e[11]||(e[11]=o=>d.priority=o),placeholder:"选择优先级"},{default:l(()=>[t(c,{label:"高优先级",value:"high"}),t(c,{label:"普通",value:"normal"}),t(c,{label:"低优先级",value:"low"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])])])):h("",!0)]),_:1},8,["modelValue"]),t(K,{modelValue:z.value,"onUpdate:modelValue":e[14]||(e[14]=o=>z.value=o),title:"文件预览",width:"90%","close-on-click-modal":!1},{default:l(()=>[s("div",jt,[D.value?(f(),C("iframe",{key:0,src:D.value,width:"100%",height:"600px",frameborder:"0"},null,8,xt)):(f(),C("div",Pt,[t(O,{size:"64"},{default:l(()=>[t(L)]),_:1}),e[39]||(e[39]=s("p",null,"文件预览加载中...",-1))]))])]),_:1},8,["modelValue"])])}}},Lt=je(Et,[["__scopeId","data-v-eded8398"]]);export{Lt as default};
