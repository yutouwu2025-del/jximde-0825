import{_ as Te}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                   *//* empty css                          *//* empty css                   *//* empty css                             *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                         *//* empty css                             *//* empty css               */import{r as S,a as Q,y as O,o as Ve,c as k,b as p,e as o,f as t,w as l,q as Me,a2 as je,J as Be,S as w,a8 as Ye,M as D,t as r,ak as Ie,H as $e,a6 as Ue,i as Ae,G as P,n,P as Qe,a4 as Ne,ab as Fe,ac as He,ad as Le,k as Re,a7 as We,s as Oe,V as qe,Y as Ge,Z as Je,ai as Ze,aj as Ke,al as Xe,F as et,h as tt,am as at,a0 as q,a1 as V,v as g}from"./index-BxcNgWEf.js";import{p as E}from"./papers-CVFD9aL8.js";const lt={class:"my-papers-container"},st={class:"page-header"},ot={class:"header-right"},nt={class:"stat-card total"},rt={class:"stat-number"},dt={class:"stat-card approved"},it={class:"stat-number"},ut={class:"stat-card pending"},ct={class:"stat-number"},pt={class:"stat-card draft"},_t={class:"stat-number"},mt={class:"filter-section"},ft={class:"papers-list"},vt={class:"paper-info"},gt={class:"paper-title"},yt={class:"paper-meta"},bt={class:"journal-name"},ht={key:0,class:"partition"},wt={class:"action-buttons"},kt={key:0,class:"batch-actions"},xt={class:"batch-info"},Ct={class:"batch-buttons"},Dt={class:"pagination-wrapper"},Pt={key:0,class:"paper-detail"},Et={key:0,class:"audit-records"},St={class:"audit-record"},zt={class:"audit-status"},Tt={class:"audit-content"},Vt={key:0},Mt={__name:"MyPapers",setup(jt){const G=Ae(),M=S(!1),j=S(!1),B=S([]),f=S([]),d=S(null),_=Q({status:"",type:"",year:"",keyword:""}),u=Q({current:1,pageSize:20,total:0}),m=Q({total:0,approved:0,pending:0,draft:0}),J=O(()=>f.value.every(a=>H(a.status))),Z=O(()=>f.value.every(a=>L(a.status))),N=a=>({journal:"期刊论文",conference:"学会论文",degree:"学位论文"})[a]||"未知",Y=a=>({draft:"info",pending:"warning",approved:"success",rejected:"danger"})[a]||"info",I=a=>({draft:"草稿",pending:"待审核",approved:"已通过",rejected:"已拒绝"})[a]||"未知",F=a=>a!=null&&a.includes("Q1")?"success":a!=null&&a.includes("Q2")?"info":a!=null&&a.includes("Q3")?"warning":"danger",K=a=>["draft","rejected"].includes(a),H=a=>["pending"].includes(a),L=a=>["draft","rejected"].includes(a),X=a=>q(a).format("MM-DD"),$=a=>q(a).format("YYYY-MM-DD HH:mm"),U=()=>{u.current=1,y()},ee=()=>{u.current=1,y()},te=a=>{f.value=a},ae=a=>{u.current=a,y()},le=a=>{u.pageSize=a,u.current=1,y()},se=a=>{d.value=a,j.value=!0,_e(a.id)},oe=a=>{G.push(`/submit-paper?edit=${a.id}`)},ne=async a=>{try{await V.confirm(`确定要撤回论文《${a.title}》吗？撤回后可以重新编辑提交。`,"确认撤回",{confirmButtonText:"确定撤回",cancelButtonText:"取消",type:"warning"}),await E.withdrawPaper(a.id),g.success("论文撤回成功"),y()}catch(e){e!=="cancel"&&g.error("撤回失败")}},re=async(a,e)=>{switch(a){case"download":de(e);break;case"history":ie();break;case"delete":ue(e);break}},de=a=>{a.file_url?window.open(a.file_url,"_blank"):g.error("文件不存在")},ie=a=>{g.info("查看论文历史功能开发中...")},ue=async a=>{try{await V.confirm(`确定要删除论文《${a.title}》吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await E.deletePaper(a.id),g.success("论文删除成功"),y()}catch(e){e!=="cancel"&&g.error("删除失败")}},ce=async()=>{try{await V.confirm(`确定要撤回选中的 ${f.value.length} 篇论文吗？`,"批量撤回",{confirmButtonText:"确定撤回",cancelButtonText:"取消",type:"warning"});const a=f.value.map(e=>e.id);for(const e of a)await E.withdrawPaper(e);g.success("批量撤回成功"),f.value=[],y()}catch(a){a!=="cancel"&&g.error("批量撤回失败")}},pe=async()=>{try{await V.confirm(`确定要删除选中的 ${f.value.length} 篇论文吗？此操作不可恢复。`,"批量删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const a=f.value.map(e=>e.id);for(const e of a)await E.deletePaper(e);g.success("批量删除成功"),f.value=[],y()}catch(a){a!=="cancel"&&g.error("批量删除失败")}},y=async()=>{var a,e,z,b;M.value=!0;try{const v={page:u.current,pageSize:u.pageSize,status:_.status,type:_.type,year:_.year,keyword:_.keyword},i=await E.getMyPapers(v);B.value=i.data.papers||[],u.total=i.data.total||0,m.total=((a=i.data.stats)==null?void 0:a.total)||0,m.approved=((e=i.data.stats)==null?void 0:e.approved)||0,m.pending=((z=i.data.stats)==null?void 0:z.pending)||0,m.draft=((b=i.data.stats)==null?void 0:b.draft)||0}catch(v){console.error("加载论文列表失败:",v),B.value=[{id:1,title:"基于深度学习的图像识别算法研究",type:"journal",journal:"Pattern Recognition",partition:"Q1",issn:"0031-3203",first_author:"张三",corresponding_author:"李四",status:"approved",created_at:"2024-01-15",updated_at:"2024-01-20",file_url:"/files/paper1.pdf"},{id:2,title:"机器学习在自然语言处理中的应用",type:"journal",journal:"Computer Science",partition:"Q2",issn:"1234-5678",first_author:"王五",corresponding_author:"赵六",status:"pending",created_at:"2024-01-10",updated_at:"2024-01-10",file_url:"/files/paper2.pdf"},{id:3,title:"人工智能发展趋势分析",type:"conference",journal:"AI Conference 2024",partition:"Q3",first_author:"陈七",corresponding_author:"周八",status:"draft",created_at:"2024-01-05",updated_at:"2024-01-08"}],m.total=3,m.approved=1,m.pending=1,m.draft=1,u.total=3}finally{M.value=!1}},_e=async a=>{try{const e=await E.getPaperDetail(a);d.value=e.data.paper}catch(e){console.error("加载论文详情失败:",e),d.value&&(d.value.audit_records=[{id:1,status:"pending",auditor:"审核员A",comment:"论文已收到，正在审核中...",created_at:"2024-01-15 10:00:00"}])}};return Ve(()=>{y()}),(a,e)=>{const z=P("Plus"),b=Qe,v=Me,i=Ne,R=je,h=He,W=Fe,me=Le,fe=P("Search"),ve=Re,x=We,C=Oe,ge=P("ArrowDown"),ye=P("Download"),A=Je,be=P("Clock"),he=P("Delete"),we=Ge,ke=qe,xe=Ue,Ce=Ie,c=Ke,De=Ze,Pe=at,Ee=Xe,Se=$e,ze=Ye;return p(),k("div",lt,[o("div",st,[e[9]||(e[9]=o("div",{class:"header-left"},[o("h1",{class:"page-title"},"我的论文"),o("p",{class:"page-description"},"管理您提交的所有论文，支持编辑和状态跟踪")],-1)),o("div",ot,[t(v,{type:"primary",onClick:e[0]||(e[0]=s=>a.$router.push("/submit-paper"))},{default:l(()=>[t(b,null,{default:l(()=>[t(z)]),_:1}),e[8]||(e[8]=n(" 提交新论文 ",-1))]),_:1})])]),t(R,{gutter:16,class:"stats-cards"},{default:l(()=>[t(i,{xs:12,sm:6},{default:l(()=>[o("div",nt,[o("div",rt,r(m.total),1),e[10]||(e[10]=o("div",{class:"stat-label"},"总论文数",-1))])]),_:1}),t(i,{xs:12,sm:6},{default:l(()=>[o("div",dt,[o("div",it,r(m.approved),1),e[11]||(e[11]=o("div",{class:"stat-label"},"已通过",-1))])]),_:1}),t(i,{xs:12,sm:6},{default:l(()=>[o("div",ut,[o("div",ct,r(m.pending),1),e[12]||(e[12]=o("div",{class:"stat-label"},"待审核",-1))])]),_:1}),t(i,{xs:12,sm:6},{default:l(()=>[o("div",pt,[o("div",_t,r(m.draft),1),e[13]||(e[13]=o("div",{class:"stat-label"},"草稿",-1))])]),_:1})]),_:1}),o("div",mt,[t(R,{gutter:16,class:"filter-row"},{default:l(()=>[t(i,{xs:24,sm:6},{default:l(()=>[t(W,{modelValue:_.status,"onUpdate:modelValue":e[1]||(e[1]=s=>_.status=s),placeholder:"论文状态",clearable:"",onChange:U},{default:l(()=>[t(h,{label:"全部",value:""}),t(h,{label:"草稿",value:"draft"}),t(h,{label:"待审核",value:"pending"}),t(h,{label:"已通过",value:"approved"}),t(h,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),t(i,{xs:24,sm:6},{default:l(()=>[t(W,{modelValue:_.type,"onUpdate:modelValue":e[2]||(e[2]=s=>_.type=s),placeholder:"论文类型",clearable:"",onChange:U},{default:l(()=>[t(h,{label:"全部",value:""}),t(h,{label:"期刊论文",value:"journal"}),t(h,{label:"学会论文",value:"conference"}),t(h,{label:"学位论文",value:"degree"})]),_:1},8,["modelValue"])]),_:1}),t(i,{xs:24,sm:6},{default:l(()=>[t(me,{modelValue:_.year,"onUpdate:modelValue":e[3]||(e[3]=s=>_.year=s),type:"year",placeholder:"发表年度",clearable:"",format:"YYYY","value-format":"YYYY",onChange:U},null,8,["modelValue"])]),_:1}),t(i,{xs:24,sm:6},{default:l(()=>[t(ve,{modelValue:_.keyword,"onUpdate:modelValue":e[4]||(e[4]=s=>_.keyword=s),placeholder:"搜索论文标题或期刊",clearable:"",onInput:ee},{prefix:l(()=>[t(b,null,{default:l(()=>[t(fe)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),o("div",ft,[Be((p(),D(xe,{data:B.value,stripe:"",style:{width:"100%"},"empty-text":"暂无论文数据",onSelectionChange:te},{default:l(()=>[t(x,{type:"selection",width:"55"}),t(x,{label:"论文信息","min-width":"300"},{default:l(({row:s})=>[o("div",vt,[o("div",gt,r(s.title),1),o("div",yt,[t(C,{size:"small",class:"meta-tag"},{default:l(()=>[n(r(N(s.type)),1)]),_:2},1024),o("span",bt,r(s.journal),1),s.partition?(p(),k("span",ht,[t(C,{size:"small",type:F(s.partition)},{default:l(()=>[n(r(s.partition)+"分区 ",1)]),_:2},1032,["type"])])):w("",!0)])])]),_:1}),t(x,{prop:"first_author",label:"第一作者",width:"120"}),t(x,{label:"状态",width:"100"},{default:l(({row:s})=>[t(C,{type:Y(s.status)},{default:l(()=>[n(r(I(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"created_at",label:"提交时间",width:"120"},{default:l(({row:s})=>[n(r(X(s.created_at)),1)]),_:1}),t(x,{label:"操作",width:"200",fixed:"right"},{default:l(({row:s})=>[o("div",wt,[t(v,{text:"",type:"primary",size:"small",onClick:T=>se(s)},{default:l(()=>[...e[14]||(e[14]=[n(" 查看 ",-1)])]),_:2},1032,["onClick"]),K(s.status)?(p(),D(v,{key:0,text:"",type:"warning",size:"small",onClick:T=>oe(s)},{default:l(()=>[...e[15]||(e[15]=[n(" 编辑 ",-1)])]),_:2},1032,["onClick"])):w("",!0),H(s.status)?(p(),D(v,{key:1,text:"",type:"info",size:"small",onClick:T=>ne(s)},{default:l(()=>[...e[16]||(e[16]=[n(" 撤回 ",-1)])]),_:2},1032,["onClick"])):w("",!0),t(ke,{trigger:"click",onCommand:T=>re(T,s)},{dropdown:l(()=>[t(we,null,{default:l(()=>[s.file_url?(p(),D(A,{key:0,command:"download"},{default:l(()=>[t(b,null,{default:l(()=>[t(ye)]),_:1}),e[18]||(e[18]=n("下载文件 ",-1))]),_:1})):w("",!0),t(A,{command:"history"},{default:l(()=>[t(b,null,{default:l(()=>[t(be)]),_:1}),e[19]||(e[19]=n("查看历史 ",-1))]),_:1}),L(s.status)?(p(),D(A,{key:1,command:"delete",divided:""},{default:l(()=>[t(b,null,{default:l(()=>[t(he)]),_:1}),e[20]||(e[20]=n("删除 ",-1))]),_:1})):w("",!0)]),_:2},1024)]),default:l(()=>[t(v,{text:"",size:"small"},{default:l(()=>[e[17]||(e[17]=n(" 更多",-1)),t(b,null,{default:l(()=>[t(ge)]),_:1})]),_:1})]),_:2},1032,["onCommand"])])]),_:1})]),_:1},8,["data"])),[[ze,M.value]]),f.value.length>0?(p(),k("div",kt,[o("div",xt," 已选择 "+r(f.value.length)+" 篇论文 ",1),o("div",Ct,[t(v,{onClick:ce,disabled:!J.value},{default:l(()=>[...e[21]||(e[21]=[n(" 批量撤回 ",-1)])]),_:1},8,["disabled"]),t(v,{type:"danger",onClick:pe,disabled:!Z.value},{default:l(()=>[...e[22]||(e[22]=[n(" 批量删除 ",-1)])]),_:1},8,["disabled"])])])):w("",!0),o("div",Dt,[t(Ce,{"current-page":u.current,"onUpdate:currentPage":e[5]||(e[5]=s=>u.current=s),"page-size":u.pageSize,"onUpdate:pageSize":e[6]||(e[6]=s=>u.pageSize=s),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),t(Se,{modelValue:j.value,"onUpdate:modelValue":e[7]||(e[7]=s=>j.value=s),title:"论文详情",direction:"rtl",size:"60%"},{default:l(()=>[d.value?(p(),k("div",Pt,[t(De,{column:1,border:""},{default:l(()=>[t(c,{label:"论文标题"},{default:l(()=>[n(r(d.value.title),1)]),_:1}),t(c,{label:"论文类型"},{default:l(()=>[n(r(N(d.value.type)),1)]),_:1}),t(c,{label:"期刊名称"},{default:l(()=>[n(r(d.value.journal),1)]),_:1}),t(c,{label:"期刊分区"},{default:l(()=>[t(C,{type:F(d.value.partition)},{default:l(()=>[n(r(d.value.partition)+"分区 ",1)]),_:1},8,["type"])]),_:1}),t(c,{label:"ISSN编号"},{default:l(()=>[n(r(d.value.issn),1)]),_:1}),t(c,{label:"第一作者"},{default:l(()=>[n(r(d.value.first_author),1)]),_:1}),t(c,{label:"通讯作者"},{default:l(()=>[n(r(d.value.corresponding_author),1)]),_:1}),t(c,{label:"所有作者"},{default:l(()=>[n(r(d.value.all_authors),1)]),_:1}),t(c,{label:"发表年度"},{default:l(()=>[n(r(d.value.publish_year),1)]),_:1}),t(c,{label:"DOI"},{default:l(()=>[n(r(d.value.doi||"未填写"),1)]),_:1}),t(c,{label:"状态"},{default:l(()=>[t(C,{type:Y(d.value.status)},{default:l(()=>[n(r(I(d.value.status)),1)]),_:1},8,["type"])]),_:1}),t(c,{label:"提交时间"},{default:l(()=>[n(r($(d.value.created_at)),1)]),_:1}),t(c,{label:"最后更新"},{default:l(()=>[n(r($(d.value.updated_at)),1)]),_:1})]),_:1}),d.value.audit_records?(p(),k("div",Et,[e[25]||(e[25]=o("h3",null,"审核记录",-1)),t(Ee,null,{default:l(()=>[(p(!0),k(et,null,tt(d.value.audit_records,s=>(p(),D(Pe,{key:s.id,timestamp:$(s.created_at),placement:"top"},{default:l(()=>[o("div",St,[o("div",zt,[t(C,{type:Y(s.status)},{default:l(()=>[n(r(I(s.status)),1)]),_:2},1032,["type"])]),o("div",Tt,[o("p",null,[e[23]||(e[23]=o("strong",null,"审核人：",-1)),n(r(s.auditor),1)]),s.comment?(p(),k("p",Vt,[e[24]||(e[24]=o("strong",null,"审核意见：",-1)),n(r(s.comment),1)])):w("",!0)])])]),_:2},1032,["timestamp"]))),128))]),_:1})])):w("",!0)])):w("",!0)]),_:1},8,["modelValue"])])}}},Kt=Te(Mt,[["__scopeId","data-v-d680e656"]]);export{Kt as default};
